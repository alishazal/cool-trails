<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
  <title>Cool Trails â€“ Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet">
  <link rel="stylesheet" href="/static/styles.css">
  <link rel="stylesheet" href="/static/home.css">
   <style>
    body {
      position: relative;
      background-color: transparent !important;
    }
#background-video {
      position: fixed;
      right: 0;
      bottom: 0;
      min-width: 100%;
      min-height: 100%;
      width: 100%;   
      height: 100%;  
      z-index: -100;
      object-fit: cover;
      filter: brightness(0.7);
      background-color: #2d3748;
    }

    .home-wrapper h1 {
       text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
    }
  </style>

</head>
<body>
    	
  <video autoplay muted loop playsinline id="background-video">
      <source id="video-source" src="" type="video/mp4">
      Your browser does not support the video tag.
  </video>
  <div class="home-wrapper d-flex flex-column align-items-center px-3 py-4 mt-3">
    <div class="w-100">
      <h1 class="mb-4">
        <img src="/static/logo_dark.svg" alt="Cool Trails Logo" style="height: 125px;"> </h1>
    </div>
    

    <form action="/search" method="get" class="w-100" style="max-width:420px;">
       <div class="input-group mb-3 position-relative">
        <input
          id="searchInput"
          type="search"
          name="q"
          class="form-control"
          placeholder="Search trails"
          aria-label="Search"
          autocomplete="off">
        <button class="btn btn-outline-success" type="submit">Search</button>

        <!-- suggestions dropdown -->
        <div id="autocomplete-list" class="list-group position-absolute w-100 mt-1"
            style="z-index:1000; max-height:200px; overflow-y:auto;">
          <!-- JS will inject: -->
          <!-- <button class="list-group-item list-group-item-action">Trail A</button> -->
        </div>
      </div>
    </form>
  </div>

  <script>
  ;(function(){
    const input = document.getElementById('searchInput');
    const list  = document.getElementById('autocomplete-list');
    let debounce;

    input.addEventListener('input', () => {
      clearTimeout(debounce);

      const q = input.value.trim();
      // if box is empty, clear and bail
      if (!q) {
        list.innerHTML = '';
        return;
      }

      debounce = setTimeout(async () => {
        try {
          const res = await fetch(`/suggest?q=${encodeURIComponent(q)}`);
          if (!res.ok) return;
          const suggestions = await res.json();

          // rebuild the list (this *always* runs on every input, incl. deletes)
          list.innerHTML = suggestions.map(item =>
            `<button type="button"
                    class="list-group-item list-group-item-action">
              ${item.trim()}
            </button>`
          ).join('');

          // wire up the click handler freshly each time
          list.querySelectorAll('button').forEach(btn => {
            btn.addEventListener('click', () => {
              const val = btn.textContent.trim();
              input.value = val;
              list.innerHTML = '';
              input.form.submit();
            });
          });
        } catch (e) {
          console.warn('Autocomplete error', e);
        }
      }, 300);
    });


    document.addEventListener('click', e => {
      if (!input.contains(e.target) && !list.contains(e.target)) {
        list.innerHTML = '';
      }
    });
  })();
  </script>
  <script>
      const videoPlayer = document.getElementById('background-video');
      const videoSource = document.getElementById('video-source');
      const videoFolderPath = '/static/videos/'; 
      const numberOfVideos = 8; 

      function setRandomVideo() {
          console.log("Attempting to set random video..."); // Log start
          if (!videoPlayer || !videoSource) {
              console.error("Error: Video player <video> or <source> element not found.");
              return;
          }
          try {
              const randomVideoNumber = Math.floor(Math.random() * numberOfVideos) + 1;
              const randomVideoFilename = `${randomVideoNumber}.mp4`;
              const randomVideoSrc = videoFolderPath + randomVideoFilename;
              console.log(`Setting video source to: ${randomVideoSrc}`);
              videoSource.setAttribute('src', randomVideoSrc);
              videoPlayer.load(); 

              videoPlayer.addEventListener('error', (e) => {
                  console.error(`Error loading video '${videoSource.src}':`, videoPlayer.error);

              }, { once: true });
          } catch (error) {
               console.error("Unexpected error during video setup:", error);
          }
      }

      document.addEventListener('DOMContentLoaded', setRandomVideo);
  </script>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js">
  </script>
</body>
</html>