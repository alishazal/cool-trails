<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cool Trails â€“ Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet">
  <link rel="stylesheet" href="/static/styles.css">
  <link rel="stylesheet" href="/static/home.css">

</head>
<body>
  <div class="home-wrapper d-flex flex-column align-items-center px-3 py-4">
    <div class="w-100">
      <h1 class="mb-4">{{message}}</h1>
    </div>
    

    <form action="/search" method="get" class="w-100" style="max-width:420px;">
       <div class="input-group mb-3 position-relative">
        <input
          id="searchInput"
          type="search"
          name="q"
          class="form-control"
          placeholder="Search trails"
          aria-label="Search"
          autocomplete="off">
        <button class="btn btn-outline-success" type="submit">Search</button>

        <!-- suggestions dropdown -->
        <div id="autocomplete-list" class="list-group position-absolute w-100 mt-1"
            style="z-index:1000; max-height:200px; overflow-y:auto;">
          <!-- JS will inject: -->
          <!-- <button class="list-group-item list-group-item-action">Trail A</button> -->
        </div>
      </div>
    </form>
  </div>

  <script>
  ;(function(){
    const input = document.getElementById('searchInput');
    const list  = document.getElementById('autocomplete-list');
    let debounce;

    input.addEventListener('input', () => {
      clearTimeout(debounce);

      const q = input.value.trim();
      // if box is empty, clear and bail
      if (!q) {
        list.innerHTML = '';
        return;
      }

      debounce = setTimeout(async () => {
        try {
          const res = await fetch(`/suggest?q=${encodeURIComponent(q)}`);
          if (!res.ok) return;
          const suggestions = await res.json();

          // rebuild the list (this *always* runs on every input, incl. deletes)
          list.innerHTML = suggestions.map(item =>
            `<button type="button"
                    class="list-group-item list-group-item-action">
              ${item.trim()}
            </button>`
          ).join('');

          // wire up the click handler freshly each time
          list.querySelectorAll('button').forEach(btn => {
            btn.addEventListener('click', () => {
              const val = btn.textContent.trim();
              input.value = val;
              list.innerHTML = '';
              // submit immediately
              input.form.submit();
            });
          });
        } catch (e) {
          console.warn('Autocomplete error', e);
        }
      }, 300);
    });

    // clicking outside closes the list, too
    document.addEventListener('click', e => {
      if (!input.contains(e.target) && !list.contains(e.target)) {
        list.innerHTML = '';
      }
    });
  })();
  </script>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js">
  </script>
</body>
</html>
